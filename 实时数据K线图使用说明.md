# å®æ—¶æ•°æ®Kçº¿å›¾ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®ç°åœ¨æ”¯æŒä¸¤ç§Kçº¿å›¾æ¨¡å¼ï¼š

1. **é™æ€æ•°æ®æ¨¡å¼** (`/` é¦–é¡µ) - ä½¿ç”¨æœ¬åœ° JSON æ–‡ä»¶çš„å†å²æ•°æ®
2. **å®æ—¶æ•°æ®æ¨¡å¼** (`/realtime`) - é€šè¿‡ WebSocket è¿æ¥ OKX äº¤æ˜“æ‰€è·å–å®æ—¶æ•°æ®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### è®¿é—®é¡µé¢

- **é™æ€æ•°æ®é¡µé¢**: http://localhost:3000/
- **å®æ—¶æ•°æ®é¡µé¢**: http://localhost:3000/realtime

## ğŸ“ é¡¹ç›®ç»“æ„

```
okx_trading/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ KLineChart.vue              # é™æ€æ•°æ®Kçº¿å›¾ç»„ä»¶
â”‚   â””â”€â”€ KLineChartRealtime.vue      # å®æ—¶æ•°æ®Kçº¿å›¾ç»„ä»¶ â­ æ–°å¢
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index.vue                   # é¦–é¡µï¼ˆé™æ€æ•°æ®ï¼‰ â­ æ–°å¢
â”‚   â””â”€â”€ realtime.vue                # å®æ—¶æ•°æ®é¡µé¢ â­ æ–°å¢
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ okxDataService.js           # OKX æ•°æ®æœåŠ¡
â”‚   â””â”€â”€ okxWebSocket.js             # WebSocket ç®¡ç†å™¨
â”œâ”€â”€ app/
â”‚   â””â”€â”€ app.vue                     # åº”ç”¨æ ¹ç»„ä»¶ï¼ˆè·¯ç”±å‡ºå£ï¼‰
â””â”€â”€ ...
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. KLineChartRealtime ç»„ä»¶

**æ–‡ä»¶**: `components/KLineChartRealtime.vue`

è¿™ä¸ªç»„ä»¶é›†æˆäº† OKX çš„å®æ—¶æ•°æ®æ¥å…¥åŠŸèƒ½ï¼š

```vue
<script setup>
import { createOKXDataLoader } from '../utils/okxDataService'
import { getOKXWebSocketManager } from '../utils/okxWebSocket'

// åˆå§‹åŒ– WebSocket ç®¡ç†å™¨
wsManager = getOKXWebSocketManager()

// è®¾ç½® DataLoaderï¼ˆå…³é”®æ­¥éª¤ï¼‰
chart.setDataLoader(createOKXDataLoader(wsManager))
</script>
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨è¿æ¥ OKX WebSocket
- âœ… å®æ—¶æ¥æ”¶Kçº¿æ•°æ®æ¨é€
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… å¿ƒè·³ä¿æ´»
- âœ… çŠ¶æ€ç›‘æ§å’Œç»Ÿè®¡

### 2. æ•°æ®æµç¨‹

```
ç”¨æˆ·è®¿é—® /realtime
    â†“
KLineChartRealtime ç»„ä»¶æŒ‚è½½
    â†“
åˆå§‹åŒ–å›¾è¡¨å’Œ WebSocket ç®¡ç†å™¨
    â†“
è®¾ç½® DataLoaderï¼ˆcreateOKXDataLoaderï¼‰
    â†“
è§¦å‘ getBarsï¼ˆåŠ è½½å†å²æ•°æ®ï¼‰
    â†“
è§¦å‘ subscribeBarï¼ˆè®¢é˜…å®æ—¶æ¨é€ï¼‰
    â†“
WebSocket è¿æ¥ OKX
    â†“
æ¥æ”¶å®æ—¶Kçº¿æ•°æ®
    â†“
å›¾è¡¨è‡ªåŠ¨æ›´æ–°
```

### 3. OKX API é›†æˆ

#### REST API - å†å²æ•°æ®
```javascript
// ç«¯ç‚¹
https://www.okx.com/api/v5/market/candles

// å‚æ•°
{
  instId: 'ETH-USDT',  // äº¤æ˜“å¯¹
  bar: '1D',           // å‘¨æœŸ
  limit: 300           // æ•°é‡
}
```

#### WebSocket - å®æ—¶æ•°æ®
```javascript
// è¿æ¥åœ°å€
wss://ws.okx.com:8443/ws/v5/business

// è®¢é˜…æ¶ˆæ¯
{
  "op": "subscribe",
  "args": [{
    "channel": "candle1D",
    "instId": "ETH-USDT"
  }]
}
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | é™æ€æ•°æ®æ¨¡å¼ | å®æ—¶æ•°æ®æ¨¡å¼ |
|------|------------|-------------|
| æ•°æ®æ¥æº | æœ¬åœ° JSON æ–‡ä»¶ | OKX äº¤æ˜“æ‰€ WebSocket |
| æ•°æ®æ›´æ–° | ä¸æ›´æ–° | å®æ—¶æ¨é€ |
| ç½‘ç»œè¿æ¥ | ä¸éœ€è¦ | éœ€è¦ |
| åŠ è½½é€Ÿåº¦ | å¿«é€Ÿ | ç¨æ…¢ï¼ˆéœ€è¦è¿æ¥ï¼‰ |
| æ•°æ®é‡ | 30å¤© | æœ€è¿‘300æ¡ + å®æ—¶ |
| å†å²æ•°æ®åŠ è½½ | âŒ | âœ… æ”¯æŒå‘å‰/å‘ååŠ è½½ |
| é€‚ç”¨åœºæ™¯ | æ¼”ç¤ºã€æµ‹è¯• | å®é™…äº¤æ˜“ã€åˆ†æ |

## ğŸ¨ é¡µé¢åŠŸèƒ½

### é™æ€æ•°æ®é¡µé¢ (`/`)

**ç‰¹ç‚¹**ï¼š
- å¿«é€ŸåŠ è½½
- æ— éœ€ç½‘ç»œè¿æ¥
- ç¨³å®šå¯é 
- é€‚åˆæ¼”ç¤ºå’Œå¼€å‘æµ‹è¯•

**å¯¼èˆª**ï¼š
- å³ä¸‹è§’æœ‰"ğŸ”´ æŸ¥çœ‹å®æ—¶æ•°æ®ç‰ˆæœ¬"æŒ‰é’®

### å®æ—¶æ•°æ®é¡µé¢ (`/realtime`)

**ç‰¹ç‚¹**ï¼š
- å®æ—¶æ•°æ®æ¨é€
- è¿æ¥çŠ¶æ€ç›‘æ§
- Kçº¿æ•°é‡ç»Ÿè®¡
- æœ€åæ›´æ–°æ—¶é—´
- è‡ªåŠ¨é‡è¿æœºåˆ¶

**çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼š
- ğŸŸ¢ å®æ—¶è¿æ¥ - WebSocket å·²è¿æ¥
- ğŸ”´ æœªè¿æ¥ - WebSocket æ–­å¼€

**å¯¼èˆª**ï¼š
- å³ä¸‹è§’æœ‰"ğŸ“Š æŸ¥çœ‹é™æ€æ•°æ®ç‰ˆæœ¬"æŒ‰é’®

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ§åˆ¶å°æ—¥å¿—

å®æ—¶æ•°æ®æ¨¡å¼ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼š

```
âœ… å›¾è¡¨åˆå§‹åŒ–æˆåŠŸ
ğŸ“Š DataLoader.getBars è¢«è°ƒç”¨: { type: 'init', ... }
ğŸ“¡ è¯·æ±‚OKXå†å²æ•°æ®: https://www.okx.com/...
âœ… è·å–åˆ° 300 æ¡Kçº¿æ•°æ®
ğŸ”Œ è¿æ¥ OKX WebSocket...
âœ… WebSocket è¿æ¥æˆåŠŸ
ğŸ”” è®¢é˜…å®æ—¶æ•°æ®: ...
ğŸ“¡ å‘é€è®¢é˜…è¯·æ±‚: { op: 'subscribe', ... }
âœ… è®¢é˜…æˆåŠŸ: { channel: 'candle1D', instId: 'ETH-USDT' }
ğŸ’“ å‘é€å¿ƒè·³: ping
ğŸ’“ æ”¶åˆ°å¿ƒè·³å“åº”: pong
ğŸ“ˆ æ”¶åˆ°å®æ—¶Kçº¿æ•°æ®: { timestamp: ..., open: ..., ... }
```

### çŠ¶æ€ç›‘æ§

å®æ—¶æ•°æ®é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºï¼š
- **è¿æ¥çŠ¶æ€**: ç»¿è‰²åœ†ç‚¹è¡¨ç¤ºå·²è¿æ¥
- **Kçº¿æ•°é‡**: å½“å‰åŠ è½½çš„Kçº¿æ€»æ•°
- **æœ€åæ›´æ–°**: æœ€è¿‘ä¸€æ¬¡æ•°æ®æ›´æ–°æ—¶é—´ï¼ˆæ¯5ç§’åˆ·æ–°ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. CORS é—®é¢˜

å¦‚æœé‡åˆ°è·¨åŸŸé”™è¯¯ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š

**æ–¹æ¡ˆAï¼šä½¿ç”¨ Nuxt API ä»£ç†**

åˆ›å»º `server/api/okx-proxy.js`ï¼š

```javascript
export default defineEventHandler(async (event) => {
  const query = getQuery(event)
  const url = `https://www.okx.com/api/v5/market/candles?${new URLSearchParams(query)}`
  return await $fetch(url)
})
```

ä¿®æ”¹ `utils/okxDataService.js`ï¼š

```javascript
// å°†è¿™ä¸€è¡Œï¼š
const url = `https://www.okx.com/api/v5/market/candles?${params.toString()}`

// æ”¹ä¸ºï¼š
const url = `/api/okx-proxy?${params.toString()}`
```

**æ–¹æ¡ˆBï¼šä½¿ç”¨ä»£ç†æœåŠ¡å™¨**

åœ¨å¼€å‘æ—¶è®¾ç½®ä»£ç†ï¼ˆä¿®æ”¹ `nuxt.config.ts`ï¼‰ï¼š

```typescript
export default defineNuxtConfig({
  // ... å…¶ä»–é…ç½®
  nitro: {
    devProxy: {
      '/api/okx': {
        target: 'https://www.okx.com/api',
        changeOrigin: true,
        prependPath: true
      }
    }
  }
})
```

### 2. WebSocket è¿æ¥é™åˆ¶

- OKX å•ä¸ªè¿æ¥æœ€å¤šè®¢é˜… **240ä¸ªé¢‘é“**
- å»ºè®®ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†è¿æ¥ï¼ˆå·²å®ç°ï¼‰
- åˆ‡æ¢äº¤æ˜“å¯¹/å‘¨æœŸæ—¶ä¼šè‡ªåŠ¨å–æ¶ˆæ—§è®¢é˜…

### 3. æ•°æ®æ›´æ–°é¢‘ç‡

- **æ—¥çº¿ (1D)**: æ¨é€é¢‘ç‡è¾ƒä½ï¼Œæ¯å¤©æ›´æ–°ä¸€æ¬¡
- **å°æ—¶çº¿ (1H)**: æ¯å°æ—¶æ›´æ–°
- **åˆ†é’Ÿçº¿ (1m, 5m)**: å®æ—¶æ¨é€ï¼Œé€‚åˆçŸ­çº¿äº¤æ˜“

### 4. å†…å­˜ç®¡ç†

ç»„ä»¶å¸è½½æ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼š
- âœ… æ–­å¼€ WebSocket è¿æ¥
- âœ… æ¸…é™¤å®šæ—¶å™¨
- âœ… é”€æ¯å›¾è¡¨å®ä¾‹

## ğŸ¯ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹äº¤æ˜“å¯¹

ç¼–è¾‘ `components/KLineChartRealtime.vue`ï¼š

```javascript
chart.setSymbol({
  ticker: 'BTC-USDT',  // æ”¹ä¸º BTC/USDT
  exchange: 'OKX'
})
```

### ä¿®æ”¹å‘¨æœŸ

```javascript
// 5åˆ†é’Ÿçº¿
chart.setPeriod({
  span: 5,
  type: 'minute'
})

// 1å°æ—¶çº¿
chart.setPeriod({
  span: 1,
  type: 'hour'
})

// 1å‘¨çº¿
chart.setPeriod({
  span: 1,
  type: 'week'
})
```

### æ”¯æŒçš„å‘¨æœŸç±»å‹

| ç±»å‹ | span | OKX channel |
|------|------|-------------|
| minute | 1, 3, 5, 15, 30 | candle1m, candle3m, ... |
| hour | 1, 2, 4, 6, 12 | candle1H, candle2H, ... |
| day | 1 | candle1D |
| week | 1 | candle1W |
| month | 1 | candle1M |

### ä¿®æ”¹æŒ‡æ ‡å‚æ•°

```javascript
// ä¿®æ”¹å¸ƒæ—å¸¦å‚æ•°ï¼ˆå‘¨æœŸï¼Œæ ‡å‡†å·®å€æ•°ï¼‰
chart.createIndicator({
  name: 'BOLL',
  calcParams: [30, 3],  // 30å‘¨æœŸï¼Œ3å€æ ‡å‡†å·®
  // ...
})
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [OKXå®æ—¶æ•°æ®æ¥å…¥æ–¹æ¡ˆ.md](./OKXå®æ—¶æ•°æ®æ¥å…¥æ–¹æ¡ˆ.md) - è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆ
- [Kçº¿å›¾ä½¿ç”¨è¯´æ˜.md](./Kçº¿å›¾ä½¿ç”¨è¯´æ˜.md) - KLineChart åŸºç¡€ä½¿ç”¨
- [å¸ƒæ—å¸¦æŠ€æœ¯æŒ‡æ ‡è¯´æ˜.md](./å¸ƒæ—å¸¦æŠ€æœ¯æŒ‡æ ‡è¯´æ˜.md) - å¸ƒæ—å¸¦æŒ‡æ ‡è¯¦è§£
- [KLineChart å®˜æ–¹æ–‡æ¡£](https://www.klinecharts.com)
- [OKX API æ–‡æ¡£](https://www.okx.com/docs-v5/)

## ğŸ› å¸¸è§é—®é¢˜

### Q: é¡µé¢æ˜¾ç¤º"æœªè¿æ¥"çŠ¶æ€ï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š
1. ç½‘ç»œé—®é¢˜ - æ£€æŸ¥ç½‘ç»œè¿æ¥
2. CORS é—®é¢˜ - å‚è€ƒä¸Šé¢çš„ CORS è§£å†³æ–¹æ¡ˆ
3. OKX æœåŠ¡å™¨é—®é¢˜ - æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q: Kçº¿æ•°æ®ä¸æ›´æ–°ï¼Ÿ

**A**: 
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤ WebSocket è¿æ¥çŠ¶æ€
3. æ—¥çº¿æ•°æ®æ¨é€é¢‘ç‡ä½ï¼Œéœ€è¦è€å¿ƒç­‰å¾…
4. å°è¯•åˆ‡æ¢åˆ°åˆ†é’Ÿçº¿æµ‹è¯•

### Q: åŠ è½½é€Ÿåº¦æ…¢ï¼Ÿ

**A**:
1. é¦–æ¬¡è¿æ¥éœ€è¦æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
2. å¯ä»¥å‡å°‘ `getBars` ä¸­çš„ `limit` å‚æ•°ï¼ˆé»˜è®¤300ï¼‰
3. æ£€æŸ¥ç½‘ç»œé€Ÿåº¦

### Q: å¦‚ä½•æŸ¥çœ‹æ›´å¤šå†å²æ•°æ®ï¼Ÿ

**A**: 
1. å‘å·¦æ‹–åŠ¨å›¾è¡¨
2. å½“æ¥è¿‘å·¦è¾¹ç•Œæ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ `forward` åŠ è½½
3. æ¯æ¬¡åŠ è½½100æ¡å†å²æ•°æ®

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ æœ‰ä¸¤ä¸ªKçº¿å›¾é¡µé¢ï¼š

1. **`/`** - é™æ€æ•°æ®ï¼Œå¿«é€Ÿæ¼”ç¤º
2. **`/realtime`** - å®æ—¶æ•°æ®ï¼Œç”Ÿäº§å°±ç»ª

ä¸¤ä¸ªé¡µé¢å¯ä»¥è‡ªç”±åˆ‡æ¢ï¼Œæä¾›äº†çµæ´»çš„å¼€å‘å’Œæ¼”ç¤ºæ–¹æ¡ˆï¼

---

ğŸ’¡ **æç¤º**: å¼€å‘æ—¶å»ºè®®å…ˆä½¿ç”¨é™æ€æ•°æ®é¡µé¢æµ‹è¯•æ ·å¼å’ŒåŠŸèƒ½ï¼Œç¡®è®¤æ— è¯¯åå†åˆ‡æ¢åˆ°å®æ—¶æ•°æ®æ¨¡å¼ã€‚

